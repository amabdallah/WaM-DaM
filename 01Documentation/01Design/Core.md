
###The Core Structure of WaM-DaM 
The core structure of WaM-DaM comprises ten configuring entities that are needed to infer the context of and relationship between water management data values in a water system. These core entities are Data Structure, Object Type, Attribute, Instance, Master Network, Scenario, and Data Storage, and MetadataMapping (blue boxes in Figure 2). ObjectAttributes and ScenarioMetadata are bridge tables that allow associating many records of each side with the other. 

The entities in WaM-DaM Core are connected in a hierarchal organizing structure. The Data Structure entity serves in the top, encompasses all other entities while the Data Storage entity is in the bottom. The central table is the MetadataMapping which maps out data values to their attributes, metadata, and organizing structure (i.e., MasterNetworks, Scenarios, ObjectTypes, Instances, and DataStructure). Therefore the MetadataMapping table is often used to query data from WaM-DaM database. 
The relationships between these entities are as follows: a Data Structure can have many Object Types and an Object Type can have many Attributes. An Attribute can be shared across many Object Types. 

A MasterNetwork can have many scenarios. A Scenario can have many Instances. An Instance inherits all the Attributes of an Object Type. An Attribute that belongs to the chain of Data Structure, Master Network, Scenario, Object Type, and Instance should have a source and method and can have many data values based on a data type selected by the user. The DataStorage table allows users to relate the same data value to many instances for the same attribute. For example, an evaporation time series can be related to many reservoir or demand site instances. The table also allows users to define many data values for the same attribute. For example, reservoir purpose has irrigation and hydropower text data values. 
The conceptual design of WaM-DaM then was implemented as an entity-relationship diagram as a logical data model maps out the relations between concepts as tables and fields in a relational data model (Figure 3). This section defines each Core entity, explains why WaM-DaM includes the entity, and how including the entity benefits WaM-DaM users.

Below are the entities in the [WaM-DaM Storage schema](http://amabdallah.github.io/WaM-DaM/diagrams/Core.html). Here is the WaM-DaM conceptual design diagram shows how the Storage Schema fitst in WaM-DaM desing

![](https://github.com/amabdallah/WaM-DaM1.0/blob/master/Files/WIKI/WaMDaM%20core%20flowchart.jpg)


####Data Structures
A [Data Structure](http://amabdallah.github.io/WaM-DaM/tables/Core_DataStructures.html) is a particular configuration and arrangement of Object Types and their Attributes in a dataset (e.g., model) for a specific domain (e.g., water supply, wastewater collection, storm water). A Data Structure allows users to organize water management data according to their own needs or to a required configuration and terminology by a model or dataset. Users may reuse the same Data Structure to build many Master Networks in many locations. So the Data Structure concept helps users configure, share, search, and reuse different structures of water management data for various domains and networks. Organizing data in different Structures in WaM-DaM is also important to filter and then serve relevant data that matches data configurations of water management models. A Data Structure has a name, structure webpage, structure domain that is constrained by controlled vocabulary, and a description. For example, WaM-DaM can organize reservoir operation and hydropower data according the data requirement and configuration in the WEAP model. The SWAT model however, does not require hydropower data. So the SWAT Data Structure will include operation data with no hydropower attributes. Users can relate the similar objects or attributes and their data values in WEAP and SWAT through the lists of controlled vocabulary. For example, a reservoir volume data can be shared between a WEAP and SWAT model with no redundancy. Although SWAT uses its native term “RES_VOL” and WEAP uses its native term “Storage Capacity”, the use of controlled common vocabulary as “volume” allows relating both of the terms and sharing the same data value. Building two WEAP and SWAT Data Structures in WaM-DaM allows users to search for reservoir data for either WEAP or SWAT models and then serve only relevant data to their models. 


####Object Types
An [Object Type](http://amabdallah.github.io/WaM-DaM/tables/Core_ObjectTypes.html) is the building element of a data structure that modelers customize its attributes to represent a distinct water system component (e.g., reservoir or a river) in their models. An Object Type may represent physical and existing water components or to represent conceptual objects like representing water gains and losses in a river though a virtual node object at a point on a river. The use of object concept here is consistent with Object Oriented Programming Language and similar to the use of Standard Names in the Community Surface Dynamics Modeling System (CSDMS) (Peckham et al., 2013). Modelers may share and reuse the same Object Type across instances of a water system component within a Data Structure. So the Object Type enforces homogeneity among all the water system instances that have the same type in the same Data Structure. 
An Object Type is specific to a Data Structure and it has a native Object name used in its Data Structure (e.g., water body), topology as a node or link and a category, native Attributes (e.g., inflow, capacity, elevation, or other customized attributes the modeler defines to match their Data Structure configuration). 

Keeping Data Structure native Attributes like Object Type name helps users preserve their data as used in their models or discipline and thus facilitate data discovery for native and common names at the same time. Keeping native object names also helps users serve data to their models in the native names that match their model. The Object Type table also incudes, map symbol for visualization purposes (e.g., diamond), and symbol color for visualization purposes (e.g., blue), description, Native Object Category reference to a metadata table that assigns the Object Type to a set of hierarchal conceptual organizing branches in a Data Structure. For example, WEAP organizes its object types under major hierarchal branches like Demand Sites, Hydrology, Supply and Resources, and Water Quality. Each of these branches could have smaller branches that belong to it and thus creating a tree of organizing concepts. A branch in WaM-DaM represents a native Objet category. So a reservoir Object Type in WEAP would belong to a native Object category “Supply and Resources”. Organizing Object Types using the native Object category concept helps users search for data by categories and then users can query data and serve it to models in the hierarchy that is required by models. 
Finally Object Type table includes a reference to a Common Object Type controlled vocabulary table (purple). This controlled vocabulary table allows users to register their native Object types with common Object types that are populated in WaM-DaM. For example, a user might have a native Object name as “Consumptive Use” but WaM-DaM uses the term “Demand Site”. Users will be required to register their native Object names if they choose to publish their data or share it with others. Registering native Object names with common terms help others relate many native names with a central controlled terms and therefore. Users can search by the controlled terms that are common to users to search for find out the native names that are used in WaM-DaM. The Common Object Type has an Object name, definition, an a category that assigns the object type to a group of object types that share similar characteristics to help in filtering and querying Object types. An Object type can belong to one or many categories and a category can apply to zero or many Object types. So users can query data from two different Object types (natural lake and man-made reservoir) that belong to similar category like surface water supply. The Object category for an Object type “Reservoir” is man-made fresh surface water supply. Note that the Object category here is static and does not for the same Object Type while the Native Object Category may change from an Object Type to another based on the Data Structure. The use of common Object type helps users search and discover related object types across data structures of the same fundamental Object types in controlled vocabulary. For example, users can search for the common Object type like reservoir to discover Object types that belong to different Data Structures and uses different names like dam, lake, and water body.
Users can share their model’s data through WaM-DaM by building Object Types in a Data Structure to match the data configuration and terminology of their model. Then they register the Object Types with the controlled vocabulary. Then they populate the data values of attributes for their Object Types with the model’s data. Finally they share the entire Data Structure with others. The advantage of sharing data using WaM-DaM is that it is self-describing with metadata and organizes its data in a consistent and common way across researchers from different disciplines. 
 
Figure 3: Logical data model of WaM-DaM core entities (blue), metadata (orange) and controlled vocabulary (CVs) (purple). The component name proceeds the table name. 

####Attribute
An [attribute](http://amabdallah.github.io/WaM-DaM/tables/Core_Attributes.html) is a specific quantitative or qualitative characteristic of an object type and allows users to describe the object properties that are needed to model water system components in user models. Similar to Object Types, the logical data model of WaM-DaM allows users to use their native attribute names and requires them to register their native terms with controlled vocabulary terms to allow searching and discovery of attributes across Data Structures and Object types. An attribute has a native name (e.g., volume or owner), a unit, description, and a reference to a common Attribute name. The native attribute in this table can be reused across Object Types through the bridge table ObjectAttributes. For example, the WEAP model reuses the same attributes like Capital Cost and Operating Cost among its Object Types Reservoir and Demand Site Object Types. However, there are specifics about each attribute when it is shared among attributes. The Attribute for a specific object has a code, a native attribute category to organize attributes that share similar characteristics to help users filter and discover attributes. Finally an Attribute can be related to another attribute within the same Object Type. For example, a “sample type” attribute may be related to a “concentration” attribute. So relating attributes to each other allows users to add metadata about other attributes. Additional Attribute metadata like source and methods are required and provided by the user at the MetadataMapping Table as explained in Section (b) below.

####Instances
An [instance](http://amabdallah.github.io/WaM-DaM/tables/Core_Instances.html) is a particular realization or implementation of an Object Type for a Data Structure in a specific location. The Instance concept helps modelers to replicate a distinct Object Type to represent specific water system components in their models with particular data values. Instances of an Object Type within a Data Structure consistently represent data across similar water system components. An Instance is referenced in space by longitude and latitude to help search and discover instances (both coordinates apply to the center of the node or link instance), and status with controlled vocabulary (e.g., existing, proposed, past existed, and planned). Instances might belong to various overlapping boundaries like politic, geographic, and hydrologic. Users can add these boundaries as attributes to Object Types. Users can search instances within boundaries of their choice by coordinates through conditional queries or by Geographic Information Systems (GIS) applications. Users also can search for instances through their boundary attributes. For example, users can search for instances that have a “watershed” attribute value of “Lower Bear River”.
The Instance inherits the properties (e.g., map symbol and map color) and attributes (e.g., inflow and capacity) of its parent Object Type. Each Instance has attributes that take Instance-specific data values. An instance can only belong to one Object Type but an Object Type can have zero or many instances. For example, an Object Type “reservoir” can have multiple instances like Hyrum and Cutler reservoirs that are located in Cache Valley, Utah. Software business rules enforce the limitation that an Instance belongs to one Object Type. There are two types of business rules in databases, the first one is implemented through the logical data model which permits or restricts relationships between tables and their fields. The second database business rule is implemented in the software to allow or permit relationships that are not originally enforced in the logical data model (Connolly and Begg, 2010). Section 5.2.4 provides examples on of how software business rules are needed in the Connections table
Consistency of instances that belong to the same Object Type reduces the time that water managers and researchers need to replicate instances in WaM-DaM and makes it easier for users to query data of similar instances. In Figure 1 above, shapes and colors are used to distinguish Object Types that have a topology of node. Shapes naming with numbers is used to distinguish instances that belong to the same Object Type. Master Networks and Scenarios are discussed in Sections 5.1.5 and 5.1.6, respectively. 
Earlier designs of the WaM-DaM core entities included separate tables for node and link instances to map out the connectivity between them and enforce connectivity business rules in the data model design (Abdallah and Rosenberg, 2014). This WaM-DaM design normalized the previous node and link Instances tables into one table. 
This WaM-DaM core design introduced here (Figure 2) includes one table for instances to reduce data redundancy as node and link instances have similar attributes. Representing instances in one table then the connection between them in another table lead to a simpler design with less number of tables that where needed to keep track of instances data values and their connections with their attributes and scenarios. The tradeoff of this simplicity is that users need to implement software business rules to enforce the integrity of connectivity between nodes and links as explained below in Section 5.2.4


####Master Networks
A [Master Network](http://amabdallah.github.io/WaM-DaM/tables/Core_MasterNetworks.html) is a specific implementation of a Data Structure, its Instances, and data values within a spatial location (e.g., Bear River Watershed, Utah). Master Networks help researchers to organize and then search groups of Instances that belong to a Data Structure in space. For example, a Data Structure for a WEAP model can be used to create separate WEAP model for the Bear River and the Weber River watersheds in Utah. Users also can share data with others by Master Networks which inherently include the related Data Structure, Objects Types, Instances, Attributes and their data values. 
A smaller Master Network and its Instances can belong to a larger parent Master Network of the same Data Structure. For example, a water supply Master Network in the Lower Bear River watershed in Utah can belong to the water supply Master Network of the entire Bear River network in a WEAP Data Structure. So an Instance can be part of two Master networks at the same time like a local Master Network and a larger regional Master Network. A Master Network has a name, spatial reference (e.g., NAD 1983) and vertical datum (e.g., above sea mean level) to help unambiguously interpret the location of Master Network Instances geographically. The spatial reference and vertical datum tables are adopted from the Observation Data Model (Horsburgh et al., 2008).

####Scenarios
A [scenario](http://amabdallah.github.io/WaM-DaM/tables/Core_Scenarios.html) organizes different topologies or connections of Instances in a Master Network and different metadata or data values for the attributes that describe those Instances. A Scenario concept helps users represent different modeling alternatives that simulate socio-economic changes in water resources networks and their data. The Scenario table helps users compare changes of data across scenarios (e.g., base line and future growth scenarios) that belong to one Master Network. The scenario concept helps users avoid redundancy by sharing Instances and their data within a Master Network among many scenarios. A Scenario also helps other people who did not develop the scenarios to learn about how similar or different these scenarios are by querying the differences among them. A scenario has a name (e.g., base case or growth), and description and reference a Master Network. A meaningful comparison between Scenarios is only possible if they belong to the same Master Network. One or more changes in Instances topology, metadata, or data within a Master Network can be defined as a Scenario. WaM-DaM references the same overlapping data in the network among all scenarios and thus avoids redundancy and allows comparison of differences. 


####Metadata Mapping and Data Storage 
The [MetadataMapping](http://amabdallah.github.io/WaM-DaM/tables/Core_MetadataMapping.html) table is the central table in WaM-DaM where data values for different formats are mapped out to their Attributes, metadata, Instances, Scenarios, Master networks, Object Types, and Data Structures (Figure 1 and Figure 3). The table helps users query and unambiguously interpret data values and populate them to models. The MetadataMapping Table connects Instances of an Object Type with its Attributes. To maintain consistency across Instances of the same Object Type, a software business rule enforces that all Instances of the same Object Type should have the same set of Attributes. 
This table also supports different data formats that are needed in water management models to represent physical, operational, and other data. Supported attribute formats include binary (e.g., gate status: 0 or 1 [closed/open]), numeric parameters (e.g., demand priority), text parameters (e.g., dam owner type: federal), file based (e.g., shapefile), seasonal parameters (e.g., winter and summer demand), time series (e.g., daily inflow), and multi-column arrays (e.g., elevation-storage-area curve). Section 5.3 below defines each of these data formats and why they are needed in modeling.
Data vales in WaM-DaM can be shared or referenced across Attributes of Instances that belong to different Scenarios and Data Structures. Referencing the same data many times opposed to duplicating it reduces redundancy and allows flexibility to reuse data values that are already exist in WaM-DaM. 
There are four cases in referencing data values many times in WaM-DaM, i) the same Attribute for the same Instance within the same Scenario can have many Data Values. For example, a reservoir can have multiple “purpose” Attribute text values like “flood control” and “hydropower”. This case is supported in the logical data model by allowing one Data Storage record to have many data values in the same format, ii) the same attribute for the same Instance can have many different data values for different Scenarios. For example, a reservoir can have two precipitation time series for base case and climate change scenarios. The “ScenarioMetadata” table in the core logical data model allows associating many MetadataMapping records with many scenarios (Figure 2), iii) the same data value for the same Attribute for the same Scenario and can be shared across instances in the same Data Structure. For example, a text value of a “dam owner type” like “Federal” can apply to thousands of instances of a dam Object Type that belong to a Scenario and a Data Structure. This case is also supported through the “MetadataMapping” table in the core logical model, and iv) the same data value of an attribute that is associated with an Object Type of a Data Structure can apply to another attribute that is associated with another Object Type within another Data Structure. This case allows users to share data values among Instances of Object Types that belong to different Data Structures. For example, reservoir inflow time series can apply for two different Hyrum Reservoir instances in a WEAP and SWAT reservoir Objects (i.e., in WEAP and SWAT Data Structures). The “MetadataMapping” table in Figure 2 allows sharing data values across Attributes of Object Types in Data Structures. The next section elaborates on the key metadata that are connected with WaM-DaM core tables to help users unambiguously interpret the 


####Scenarios
The [ScenarioMetadata](http://amabdallah.github.io/WaM-DaM/tables/Core_ScenarioMetadata.html)entity in the core logical data model allows associating many MetadataMapping records with many scenarios. 







