
##Data Storage in WaM-DaM

WaM-DaM supports nine different data values formats that are frequently used water management models to represent among others physical and operational data. Separating data based on their format reinforces the integrity of the data model and guides users to only populate or query relevant data values. So WaM-DaM stores numeric data values separately from text data values. Each data values table is connected to the Data Storage Table in the WaM-DaM Core based on the attribute format that the user chooses. This section elaborates on each data format and why it is needed. The section starts with simple Binary data and ends at the complex Multi-Column Array format. Below are the entities in the [WaM-DaM Storage schema](http://amabdallah.github.io/WaM-DaM/diagrams/DataStorage.html). Here is the WaM-DaM conceptual design diagram shows how the Storage Schema fitst in WaM-DaM desing

Separating data values based on their format reinforces the integrity of the data model and guides users to only populate or query relevant data values. Integrity here means that data values are stored in and then accessed only from one place based on their attribute data type. For example, WaM-DaM stores numeric data values (e.g., parameter) separately from text data values (e.g., text controlled of free). Each data value’s table is connected to the Data Storage Table in the WaM-DaM based on the attribute format that the user chooses. 

![](https://github.com/amabdallah/WaM-DaM/blob/master/01Documentation/01Design/WaMDaM_Logical.jpg)


###Binary
The [Binary](http://amabdallah.github.io/WaM-DaM/tables/Storage_SeasonalParameters.html) table stores binary data values of either zero or one to direct users to only populate binary values to represent water management operations that has duel values. Water management models uses binary values in their algorithms to simulate operation actions. The table has a Binary Value and a “Binary Value Meaning” field that is a controlled vocabulary term registered by the user in WaM-DaM. For example, zero or one refers to a canal gate being “close” or “open”. 
Parameters
This table stores data values of single numeric parameters like an elevation of 45.5 that could have a unit of meter. The Parameters table helps users organize and separate their numeric data values for direct storage and access. Users can also specify additional metadata about the parameter through an attribute ParameterSubName like “lower bound” or “upper bound”.

###Seasonal Parameter
The [SeasonalParameter](http://amabdallah.github.io/WaM-DaM/tables/Storage_SeasonalParameters.html) table stores multiple numeric data values of parameters that correspond to pattern changes in time but not necessarily the four seasons (e.g., winter, summer, day, and night). Seasonal patterns are used in water management models to represent data changes due to system operation. The table guide users to populate and query seasonal data values with their specific metadata like season name which is controlled from a predefined list and season start and end dates. For example a “water right” seasonal parameter can have 20 acre-feet in winter and 5 acre-feet in summer or a water demand parameter can take 10 cfs at day and 5 cfs at night.

###TextFree
The [TextFree](http://amabdallah.github.io/WaM-DaM/tables/Storage_TextFree.html) table stores descriptive text data values and helps users to flexibly add metadata that describe their water system operation. For example, a dam release rule could be described in text as the dam operator narrates their experience on how they release water from a dam. Another example is a “dam owner name” as Cache County or PacifiCorp.

###TextControlled
The [TextControlled](http://amabdallah.github.io/WaM-DaM/tables/Storage_TextControlled.html) table  is similar to Text Free table but this one enforces controlled vocabulary on text data values to help users consistently define static descriptive text data values across instances. For example, a user can choose the owner type of a reservoir from a user predefined list like Federal, State, Local, and Private. This consistent definition of text values helps users query and discover a range of data values that are already known to the user through the list of controlled vocabulary. 

###File Based
This [FileBased](http://amabdallah.github.io/WaM-DaM/tables/Storage_FileBased.html) table stores references for data files which cannot be supported directly in WaM-DaM like maps, images, and documents. This table helps users attach the relevant documents to the water system components to further describe them. Users can search and discover these files through their metadata (e.g., name and format) but users cannot discover information inside these files through the WaM-DaM relational database. The table stores the file title and path on disk and file type (e.g., map or shapefile) as a user defined controlled vocabulary. 

###Rule
The [Rule](http://amabdallah.github.io/WaM-DaM/tables/Storage_Rules.html) table stores relationships between attributes of instances in the form of mathematical equations to help users represent water management actions as conditional rules and use them in their models. For example, system dynamic models represent mass balance for water system objects like reservoirs in the form of equations that aggregate other attributes, these aggregate attributes contribute to “addition rate” or withdrawal rate” from a reservoir. So the table stores references to the function variables that are already stored in other tables like time series or parameters. The table then stores the mathematical operation (e.g., +, -, *, /) that follows each variable from a controlled list of vocabularies defined by the user. Finally the function table stores the variable order as an integer from left to right to preserve the order of variables in a function. For example, a water addition to a reservoir in a system dynamic model is a function of other attributes like precipitation and inflow. So an “Addition” function references the variable “inflow” followed by the “plus” sign with an order of “1”. The function also references the “precipitation” variable with no sign or leaves it blank with an order of “2”. The user can query the function along with its constituting variables. Users also can query each variable to learn about its data values and metadata and then serve its data values to their model.     

###Time Series
This tables stores a series of data values that have serial time stamps to help organize, manipulate, and discover environmental observations for water management models. WaM-DaM supports the important metadata that are necessary to unambiguously interpret time series data within the context of water management modeling. WaM-DaM uses the time scale triplet in time series data which represents i) extent which is the full time range over of measurements, ii) spacing which is the time spacing between measurements, and iii) support which is the time interval when statistical aggregation applies to a set of measurement and then the aggregated value is reported (e.g., hourly measurement values are averaged over a day to report daily values). Refer to (Tarboton et al., 2008) for further details on time scale triplet.
WaM-DaM organizes time series data in two separate table. 

The first table [TimeSeries](http://amabdallah.github.io/WaM-DaM/tables/Storage_TimeSeries.html) includes metadata that are fixed for all the data values of a time series. The second table [TimeSeriesValues](http://amabdallah.github.io/WaM-DaM/tables/Storage_TimeSeriesValues.html) includes the time series data values and their time stamp. Times series metadata in the first table include, begin and end time/dates which are derived from the extent of data values in the second table to allow users to search time series data by begin and end dates, then “IsRegular” to indicate if the time spacing is regular or not. Water management models often use regular time stamps but calibration data might be measured irregularly. So WaM-DaM supports both regular and irregular time series. Finally, time support is represented through an aggregation statistic defined in controlled vocabulary (e.g., cumulative, average, maximum), aggregation interval (e.g., 1), and interval time unit (e.g., day). For example, a water management model may require time series of water consumption volumes for a city in cumulative monthly values, but in reality the city reports consumption in cumulative daily volumes. So the aggregation statistic for the model is reported as “cumulative”, the aggregation interval is reported “30”, and the interval time unit is reported as “day.” Time stamp can be at any level of granularity (e.g., hours, months) according to the W3C date/time encoding standard (Wolf and Wicksteed, 1997). 

On the other hand, WaM-DaM does not explicitly support other metadata like data value accuracy, quality control level, and universal and local time and their time because these metadata often are not used or needed in water management models. Users however, can note these metadata in the attribute description field in Data Storage table. Users also could refer to the original source of data if needed to identify any of these metadata for data values. Users are encouraged to use the Observation Data Model if they need to organize and search such micro metadata for their data values  

###Multi-Column Array
This table stores data values of two or more attributes that are paired together to help users organize, manipulate, and query water system paired attributes and serve them to their models. Examples of paired attributes in water management data are water cost that changes with demand and time (e.g., month of the year), and reservoir volume that changes with elevation and surface area. The Multi-Column Array is adapted from the OGC Network Common Data Form (NetCDF) Core Encoding Standard (OGC, 2011). We adopt the concepts of defining a dataset with global metadata attributes and then defining the array’s many variables with their metadata and data values. WaM-DaM logical data model stores the array’s data and metadata in two tables (figure 5). The first table [MultiColumnArray](http://amabdallah.github.io/WaM-DaM/tables/Storage_MultiColumnArray.html) references the array unique identifier. The identifier references an array name (e.g., cost-demand-time) with as many columns (i.e., attributes are cost, demand, and time) that constitute the array. Each column (i.e., attribute) has its unique metadata like unit, and the entire array has its collective or global metadata like source. The second table [MultiColumnValues](http://amabdallah.github.io/WaM-DaM/tables/Storage_MultiColumnValues.html) stores the data values for each column in the array along with a value order as an incremental integer (1, 2, 3…) that corresponds to the original order of data values in the paired array. The value order preserves the correct pairing between data values across columns of the same array. Users then can query the entire array or they can query subsets of it to populate their model with the relevant data. For example, a WEAP model requires a reservoir volume and elevation columns while a ResSim model also requires the surface area column. So organizing data values in a relational format allows users to access and query data values without the need for additional software capabilities. 
